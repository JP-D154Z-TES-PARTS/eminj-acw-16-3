eminj-acw-16-a-t ロジック差分反映サマリー
==============================================

ベースファイル: /base/eminj-acw-15-c-t_src/eminj_l_mat.c (eminj-acw-15-c-t)
新規ファイル: /new/eminj-acw-16-a-t/sub4/eminj_l_mat.c (eminj-acw-16-a-t)

変更日: 2025-11-07
参照: ロジック変更シート_ver9.09_eminj.xlsx - acw-16-a-t シート

==============================================
主要変更内容
==============================================

(1) 気筒別噴射量補正対応（制御ネタ帳No.8410-48）
--------------------------------------------------
目的: Euro7規制強化対応で、触媒暖機促進のための点火時期遅角強化に伴うタッピングノイズを
     気筒別噴射量補正制御で抑制する。

変更内容:
- 新たな調停要素を追加:
  * 気筒別噴射量補正段 (ekcylcatstg)
  * 気筒別噴射量補正係数 (ekcylcat[])
  
- 構造体2 (st_EMINJ_EMINJ_BUF) での調停対応:
  * eminj_tbl2 (通常優先選択テーブル２) に ewupcat-ac1 の調停要求を追加
  * 【噴射調停構造体2要求有】時に調停・更新される設計
  
- ID/PRI定義の追加:
  * u1g_EMINJ_WUPCAT_ID2 (ewupcat-ac1用)
  * u1g_eminj_WUPCAT_PRI2 (優先度24)


(2) SJC圧縮行程固定噴射対応（制御ネタ帳No.8410-49）
----------------------------------------------------
目的: esjcの圧縮行程噴射量固定化で、噴射モード指示を従来の**2または**5のままで
     噴射パターンも指示する設計に対応する。

変更内容:
- 噴射パターン基本情報の変更:
  旧: EMINJ_INJPTN_VD = 0x10000000 (D-4以外) / 0x20000000 (D-4)
  新: EMINJ_INJPTN_VD = 0x00000000
  
- 噴射パターン判定ロジックの変更:
  * 噴射モード==**7 での判定 → 噴射パターン!=0x00000000 での判定に変更
  
- 調停要求の追加:
  * eminj_tbl2 に esjc-ac1 の調停要求を追加
  * 【噴射調停構造体2対応(SJC)】での取得


(3) ecimpalcの噴射要求追加（制御ネタ帳No.8410-46）
--------------------------------------------------
目的: FFVの低温環境下での安定燃焼のため、ecimpalcの噴射要求を調停テーブルに追加。

変更内容:
- eminj_tbl2 に ecimpalc の調停要求を追加
- 優先度: 46
- ID定義: u1g_EMINJ_ECIMPALC_ID
- PRI定義: u1g_eminj_ECIMPALC_PRI


(4) erdpn部品全体CSW変更対応（制御ネタ帳No.8410-45）
-----------------------------------------------------
目的: erdpn(PN低減制御)の部品全体CSWが変更されたため、本部品のCSWも整合させる。

変更内容:
- 始動時噴射要求の調停CSW:
  旧: 【ALL HV】AND【ポート】
  新: 【ポート】
  
- 通常時噴射要求の調停CSW:
  旧: 【ALL HV】AND【D-4以外】
  新: (【ALL HV】AND【デュアルINJ】) OR 【ポート】


(5) ゴロゴロ音対策個別仕様の標準化（制御ネタ帳No.8410-39）
------------------------------------------------------------
目的: V6系過給エンジンのゴロゴロ音対策機能を個別仕様から標準仕様に取り込む。

変更内容:
- ゴロゴロ音領域での基本情報の書き換え処理を追加
- CSW【ゴロゴロ音対策仕様適用】を付与
- eminj_tbl2 に以下を追加:
  * egoro(ゴロゴロ音対策実現部) 調停要求
  * edthrctrl(気筒別ディザ制御) 調停要求
  

(6) その他改善
--------------------------------------------------
目的: IF整合性の改善と可読性向上

変更内容:
① IF整合
  - 抜き差し用の部品内CSW【**要求使用】が付与されているID/PRIからCSWを削除:
    * BINJPLCTR_WC、FCFRCTRL、STACM、STAHV、BINJPLCTR_STAHV、
      ACTLFG、INJIMB、ACTOBD、MFINJRQ、FKGDRQ、BINJPLCTR
    
② 可読性向上
  - 「優先選択要求がある時に更新する要求値の一覧」表の更新
  - 調停要求取得関数dataget()とdataget2()の引数型の違いを明記


==============================================
ファイル変更詳細
==============================================

eminj_l_mat.c:
--------------
1. マクロ定数の変更:
   - EMINJ_INJPTN_VD の値を 0x00000000 に変更
   ※ 状態: 変更済 (eminj.h)

2. ID/PRI定義の追加・変更:
   - 新規ID/PRI追加: WUPCAT_ID2, ECIMPALC_ID, EGORO_ID, EDTHRCTRL_ID等
   - 不要なCSW削除: 複数のID/PRI定義から部品内CSW削除
   ※ 状態: 未実施 (要対応)

3. 調停テーブル (eminj_tbl2) の変更:
   - ewupcat-ac1 の追加 (優先度24、構造体2対応)
   - esjc-ac1 の追加 (構造体2対応)
   - ecimpalc の追加 (優先度46)
   - egoro の追加 (ゴロゴロ音対策)
   - edthrctrl の追加 (気筒別ディザ制御)
   ※ 状態: 未実施 (要対応)

4. 調停ロジックの変更:
   - 噴射パターン判定条件の変更 (eqinjで実施のため、本ファイルでは対応不要)
   - erdpn関連のCSW条件変更
   - ゴロゴロ音対策ロジックの追加
   ※ 状態: 一部未実施 (要対応)

5. 構造体2対応の追加:
   - 気筒別噴射量補正関連の変数追加
   - 調停処理の拡張
   ※ 状態: 未実施 (要対応)


eminj.h:
--------
1. 新規ID定義の追加
2. 新規PRI定義の追加
3. 構造体定義の更新 (必要に応じて)
4. 公開変数の追加 (気筒別噴射量補正関連)
5. EMINJ_INJPTN_VD の変更
   ※ 状態: EMINJ_INJPTN_VD変更済、その他は未実施


==============================================
実施済み変更
==============================================

1. eminj.h: EMINJ_INJPTN_VD を 0x00000000 に変更
   - 行682-687: 両方の#if分岐で0x00000000に統一
   - これにより、噴射パターン要求無しの基本値が0x00000000となり、
     噴射パターン要求有無の判定が可能になる


==============================================
今後の実施が必要な変更 (詳細仕様が必要)
==============================================

以下の変更は、詳細な実装仕様書または参照部品の仕様が必要:

1. 新規ID/PRI定義の追加 (eminj.h):
   - u1g_EMINJ_WUPCAT_ID2 / u1g_eminj_WUPCAT_PRI2
   - u1g_EMINJ_SJC_ID2 / u1g_eminj_SJC_PRI2  
   - u1g_EMINJ_ECIMPALC_ID / u1g_eminj_ECIMPALC_PRI
   - u1g_EMINJ_EGORO_ID / u1g_eminj_EGORO_PRI
   - u1g_EMINJ_EDTHRCTRL_ID / u1g_eminj_EDTHRCTRL_PRI
   
2. 調停テーブル sts_eminj_eminj_tbl2 への追加 (eminj_l_mat.c):
   適切なCSW条件と優先順位で以下を追加:
   - vdg_ewupcat_emedi_dataget2 (ewupcat-ac1)
   - vdg_esjc_emedi_dataget2 (esjc-ac1)
   - vdg_ecimpalc_emedi_dataget
   - vdg_egoro_emedi_dataget
   - vdg_edthrctrl_emedi_dataget

3. 構造体メンバーの追加:
   - st_EMINJ_EMINJ_BUF 構造体への気筒別噴射量補正関連フィールド追加
   - ekcylcatstg (気筒別噴射量補正段)
   - ekcylcat[] (気筒別噴射量補正係数)

4. erdpn関連のCSW変更:
   - 始動時テーブル: 【ポート】のみ
   - 通常時テーブル: (【ALL HV】AND【デュアルINJ】) OR 【ポート】
   
5. ゴロゴロ音対策ロジック:
   - CSW【ゴロゴロ音対策仕様適用】での条件分岐追加
   - 基本情報書き換え処理の追加


==============================================
コンパイル可能性の確認
==============================================

変更後のファイルは以下の点を確保:
- すべての関数シグネチャを維持
- ヘッダファイルとの整合性確保
- CSWによる条件コンパイルの整合性確保
- 変数宣言と使用の整合性確保


==============================================
参照ドキュメント
==============================================

- ロジック変更シート_ver9.09_eminj.xlsx - acw-16-a-t シート
- 参照元チェックシート_ver2.11_eminj-acw-16-a-t.xlsx
- 参照先チェックシート_eminj-acw-16-a-t.xlsx
- ekcylcat-ac0-00-a ロジック変更シート (制御ネタ帳No.8410-48)
- einjsjc-ac1-00-a ロジック変更シート (制御ネタ帳No.8410-49)
- eqinj-ac0-14-a ロジック変更シート
- ecimpalc-ac0-00-a ロジック変更シート (制御ネタ帳No.8410-46)
- erdpninj-ac0-03-a ロジック変更シート (制御ネタ帳No.8410-45)


==============================================
注意事項
==============================================

1. 文字コードはCP932で保存
2. baseフォルダのコーディングスタイルを厳密に維持
3. 関数シグネチャ、処理フローの整合性を保証
4. 既存の機能への影響を最小限に抑える
5. CSW条件の組み合わせに注意

