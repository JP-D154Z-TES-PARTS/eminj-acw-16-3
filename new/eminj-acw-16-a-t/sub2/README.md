# sub2: l_mat.cと仕様書の対応関係マッピング

## 概要

このフォルダには、baseフォルダの`eminj_l_mat.c`ソースコードと仕様書（`ロジック変更シート_ver9.09_eminj.xlsx`）の対応関係を分析したドキュメントが含まれています。

## 成果物

### 1. l_mat.c_仕様書対応マップ.md

**内容:**
- 仕様書とソースコードの全体的な対応関係
- 4つのパブリック関数の詳細説明
- 12のスタティック関数の一覧
- 重要なデータ構造の説明
- 計算式とアルゴリズムの解説
- 条件コンパイルとバリエーション
- 仕様書セクションとコードの対応表

**用途:**
- sub4のロジック差分反映作業の基礎資料
- コード理解のための参照ドキュメント

### 2. 関数対応表.md

**内容:**
- 各パブリック関数の詳細情報（関数名、日本語名、行番号、タイミング、引数、戻り値）
- 各関数の機能説明
- 仕様書との対応セクション
- 主要な処理フローの説明
- スタティック関数の一覧表

**用途:**
- 関数単位での詳細な仕様理解
- コード変更時の影響範囲の特定

### 3. 処理フロー図.md

**内容:**
- 全体システムフローの図解
- 初期化処理フロー (vdg_eminj_pwon)
- メイン調停処理フロー (vdg_eminj_8msm)
- 優先度判定処理フロー
- データ取得インターフェースフロー
- データフロー図
- タイミングチャート
- 条件分岐の主要パターン

**用途:**
- 処理の流れの視覚的理解
- デバッグ時の処理追跡
- 新規メンバーへの教育資料

## ファイル構成

```
sub2/
├── README.md                        (このファイル)
├── l_mat.c_仕様書対応マップ.md      (11KB) - 総合マッピングドキュメント
├── 関数対応表.md                    (4.8KB) - 関数詳細対応表
└── 処理フロー図.md                  (32KB) - フロー図とダイアグラム
```

## 分析対象

### ソースコード
- **ファイル**: `/base/eminj-acw-15-c-t_src/eminj_l_mat.c`
- **総行数**: 4,962行
- **パブリック関数数**: 4
- **スタティック関数数**: 12

### 仕様書
- **ファイル**: `/base/eminj-acw-15-c-t_spec/document/ロジック変更シート_ver9.09_eminj.xlsx`
- **対象シート**: acw-15-c-t
- **モジュール名**: eminj-acw-15-c-t

## パブリック関数一覧

1. **vdg_eminj_pwon** (行 721)
   - 初期化処理
   - 呼出タイミング: pwon時

2. **vdg_eminj_8msm** (行 814)
   - 噴射要求の調停処理
   - 呼出タイミング: 8msm時

3. **vdg_eminj_einj_dataget** (行 2604)
   - 噴射情報取得（旧構造）
   - 呼出タイミング: 任意

4. **vdg_eminj_eminj_dataget** (行 2730)
   - 噴射情報取得（新構造）
   - 呼出タイミング: 任意

## 主要な処理概要

### 初期化処理 (vdg_eminj_pwon)
- 噴射量補正係数の初期設定
- ポート噴射係数の初期化
- データ構造の初期化

### 調停処理 (vdg_eminj_8msm)
- 各機能モジュールからの噴射要求データ取得
- 優先度テーブルによる調停
- 最高優先度要求の選択と反映
- 補正係数の適用

### データ取得 (vdg_eminj_*_dataget)
- 調停結果のデータを外部に提供
- 排他制御による安全なアクセス
- 旧構造と新構造の両対応

## 重要なデータ構造

### st_EMINJ_EINJ
旧構造の噴射情報を格納
- パブリック変数: `stg_eminj_einj`
- 主要メンバ: s2_qinjall, s2_ainjall, s2_krchref等

### st_EMINJ_EMINJ
新構造の噴射情報を格納
- パブリック変数: `stg_eminj_eminj`
- 主要メンバ: s2_qinjall（噴射段対応）, s2_ainjall等

## 次のステップ (sub4での活用)

このマッピング情報を基に、以下の作業を実施:

1. **仕様書の差分抽出**
   - 新旧仕様書の比較
   - 変更箇所の特定

2. **対応するコード箇所の特定**
   - このマッピングを使用してコード箇所を特定
   - 影響範囲の分析

3. **差分のコードへの反映**
   - 特定したコード箇所の修正
   - 関数間の依存関係の確認

4. **テストケースの作成と検証**
   - 変更箇所のテスト計画
   - 回帰テストの実施

## 注意事項

1. **完全性**: このマッピングは自動生成された基礎資料です。詳細な仕様理解のためには、元の仕様書とソースコードを直接参照してください。

2. **正確性**: コメントの解析は文字エンコーディングの問題で一部が正しく表示されない場合があります。必ず元のソースコードで確認してください。

3. **更新**: ソースコードや仕様書が更新された場合、このマッピングも更新が必要です。

## 作成情報

- **作成日**: 2025-11-07
- **作成方法**: 自動分析スクリプトによる生成
- **対象バージョン**: eminj-acw-15-c-t (base)

## 関連ドキュメント

- 仕様書: `/base/eminj-acw-15-c-t_spec/document/ロジック変更シート_ver9.09_eminj.xlsx`
- ソースコード: `/base/eminj-acw-15-c-t_src/eminj_l_mat.c`
- 新仕様書: `/new/eminj-acw-16-a-t/document/ロジック変更シート_ver9.09_eminj.xlsx`

---

このドキュメントは、sub2タスク「baseフォルダのl_mat.cと仕様書の対応関係を理解する」の成果物です。
